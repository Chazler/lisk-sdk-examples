= Workshop: Lisk Transport
Mona Bärenfänger <mona@lightcurve.io>
:toc:
:experimental:

== Motivation

One reason why the modern world is seeing more and more wealth created is because the economies and markets are connected via ever more sophisticated routes of global trade.
Whether be it by air, sea, or road, billions worth of goods are being taken from continent to continent every single day, in order to satisfy demand and meet supply quotas.
However, while new methods of storage and route tweaks are still developed in order to further propel this vital aspect of the global economy, the sheer volume of transport information processed on a daily basis means there is huge inaccuracy of data when trying to monitor an individual product’s journey.
Major business leaders depending on physical supply chains have long pushed for more transparency, price-efficiency and data insight, starting at the creation of a product to its final destination.

Applying blockchain to a supply chain could resolve these problems by creating a permanent history of a product.
This can have many industry-spanning benefits - reducing costs, pinpointing human error and avoiding delays.
All of this could potentially save years of time and billions of dollars in overhead.
Vendors and suppliers could benefit from a greater insight into the manufacturing process of the goods they use, being able to use the decentralized supply ledger in order to investigate variables such as delivery or maintenance of products.
For certain industries where high maintenance of goods in the supply chain is especially crucial, we can envision how blockchain can step in in order to ensure that quality targets are being met.
For example, medical or aerospace science industries could easily utilise blockchain supply chain in order to ensure the parts and chemicals they use in their work come from a reputable source and have had all the necessary storage requirements met in the journey to its final destination.

Retail giants on another hand, can be one of the primary examples of blockchain use cases if we consider how the immutable, trustless nature of a supply chain can be used to crack down on the ethical implications of how some of the raw foods are being sourced, but also improve quality and investigate where the spoiled food came from and how it got on the store shelf.
Insights like these help today’s retailers improve storage and farming techniques in order to raise the food standard for the end customer as well as reduce the amount of food waste that does not meet contemporary health and safety regulation requirements.

Benefiting from the insights provided by blockchain supply chain could also help level the playing the field of small to mid-size businesses against corporate giants.
If we consider the reduction in costs for a company which opts for a permanent, insightful blockchain-based supply chain monitoring will be astronomical when compared to a costly supply chain or operations manager.
A greater, atomised transparency for all stages of the supply chain could perhaps also have a positive effect on curbing global drug trade channels and goods theft, crime types which benefit from murky intercontinental trade lines.

image::blockchain-supply-chain.jpg[Blockchain Supply Chain]

=== Conclusion

To conclude, blockchain can benefit supply chain and transport industries by introducing a new level of data transparency and responsiveness that helps to improve processes and attracts potential clients.
On another hand, applying blockchain to certain supply chains can benefit the end consumer, primary producer, and any other party inbetween, through better insights about how any product came to be.

Supply chains of the future are poised to continue being more responsive, efficient and flexible than their contemporaries.
With the global trade networks at stake, blockchain will help flesh out the correct pathways for goods to travel from continent to continent and from producer to end customer.

== Idea

The goal is to create a simple decentralized supply chain tracking system.

Before registering the packet on the network, the sender needs to create a new account for the packet and store the passphrase on the IoT device inside the packet.
This is necessary, because the packet needs to sign the transactions it sends to the network, in order to communicate with it.
The packets are registered on the blockchain network by the packet sender.

As next step, a carrier would go to the packet senders' address, receive the packet and start the delivery to the recipient.
The carrier needs to sign a transaction, that verifies that the packet has been passed on to the carrier.
With this transaction, the Carrier will lock a certain amount of tokens in his account, that was defined by the packet sender when registering the packet on the network.

During the transportation of the packet, the packet will track itself, to check if it gets manipulated during the travel.
If a manipulation is detected, it will send a self-signed alarm transaction to the network.

When reaching the recipient of the packet, the carrier passes the packet to the recipient.
The recipient needs to sign a transaction, that verifies that the packet has been passed on to the recipient.

image::transport-uml.svg[Flow chart of Lisk Transport]

== Requirements

=== Hardware

==== Hardware to bring yourself
* Laptop with one of the following OS installed:
** Ubuntu 16.04 (LTS) x86_64
** Ubuntu 18.04 (LTS) x86_64
** MacOS 10.13 (High Sierra)
** MacOS 10.14 (Mojave)

==== Hardware provided
* Raspberry Pi Zero W
* SD card
* Photoresistor
* Jumper cables
* Temp/Humidity sensor
* USB -> Micro-USB cable
* Battery/Powerbank

=== Software Prerequisites
* Code editor like Visual Studio Code
* Node.js (v10 or higher installed - use nvm for easy switching between versions)
* Have curl installed
* Have Postgres installed (xref:https://lisk.io/documentation/lisk-sdk/setup[Installation guide by Lisk]). Notice, we also talk about creating a lisk user on your system, for MacOS this is not needed.

=== Software

To achieve this, 3 different kind of applications need to be developed:

A blockchain application::
which accepts the application-specific <<_custom_transactions, transaction types>>.
This application needs to be installed on different independent nodes and will setup and maintain the blockchain which is used to store the data about the packets, carrier and users.
A client application::
which is displaying information from the blockchain to the user.
It needs a frontend, which should be listing at least a list of packetIDs, the carrier, sender, recipient, and a status field (`pending | ongoing | alarm | success | fail`).
It should also provide an easy way to create and send the different transaction types to the network.
An IoT application::
which is stored on a microcontroller/raspberry pi. This application will track that the packet is not manipulated during the delivery.
To do this, certain sensors will be connected to it, that track information like light, temperature and/or humidity inside of the packet.
If something unexpected is detected by the IoT app, it will create a transaction object, sign it, and send it to the network.

== Part 1: Track a packet on the blockchain

=== 1.0 Setup of the project

. Clone xref:https://github.com/LiskHQ/lisk-sdk-examples/[Lisk-SDK-Examples] repository locally.
. Checkout branch `development` (by default active branch).
. Navigate inside `transport/node` folder and run `npm install` to install the required dependencies for the node application.
. To verify if the setup is correct, try to run the application with `node index.js | npx bunyan -o short`.
This command will run the `index.js` file and pipe the outputted logs to our preferred log formatting tool Bunyan.
If everything is running fine, you can stop the node, by hitting kbd:[CTRL+C].
. Setup the database:
.. In case you have experimented before with Lisk, it is possible you have to first drop your database and recreate it with: `dropdb lisk_dev && createdb lisk_dev --owner lisk`.
.. If you set up the Lisk SDK for the first time, run the following 2 commands:
[source, bash]
----
sudo -u postgres -i createdb lisk_dev --owner lisk
sudo -u postgres psql -d lisk_dev -c "alter user lisk with password 'password';"
----

=== 1.1 Implement the LightAlarm transaction

* Implementation of the LightAlarmTx
* Registering it with the node application

=== 1.2 Prepare the IoT device

* Connect the sensor
* Install Node
* Prepare to connect to ssh via USB

=== 1.3 The Web application

* Initalize the packet account
** Create the packet credentials
** send 1 Beddow to packet from the genesis account, to initliaze the packet account
* Light-alarm explorer: Displaying

=== 1.4 The IoT application

* Read the sensor in a certain interval
* Send LightAlarmTx, if light is detected
* Make script start automatically after boot

== Part 2: A simple supply chain tracking system

=== 2.1 Implement RegisterPacket, StartTransport and FinishTransport transactions

==== a. Register packet on the blockchain

==== b. Start the Transport

==== d. Finish the Transport

=== 2.2 Extend the web application

=== 2.3 Test it out!

==== Test run on local blockchain

A full test run of the supply chain tracking workflow with the blockchain application

==== Connecting multiple nodes

This sections explains how to connect several nodes to your blockchain, and how to exchange the dummydelegates with real ones.
